import{i as q,_ as C,r as o,o as l,c as f,f as i,w as r,j as B,h as U,F as h,a as k,e as g,t as b,b as L,d as x,k as V,u as $,m as j}from"./index-8cfa54d1.js";import{u as E}from"./game-systems-47a1067a.js";import{A as J}from"./AppBar-2bd85a52.js";const M=q("armyList",{state:()=>{let n=JSON.parse(localStorage.getItem("armyList"));return n?{armyList:n}:{armyList:{name:"",points:-1,selectedGameMode:null}}},actions:{getArmyList(){return this.armyList},updateArmyListState(n){this.armyList=n,localStorage.setItem("armyList",JSON.stringify(n))}}}),R={name:"ListCreationDialog",props:{gameModes:{type:Array,required:!0}},emits:["armyDetailsSaved"],data(){return{valid:!1,armyName:"",armyPoints:-1,selectedGameModeIndex:null,armyNameRules:[n=>!!n||"Name is required"],armyPointsRules:[n=>Number(n)?!0:"Point limit must be a number",n=>Number(n)>=-1&&Number(n)<1e4?!0:"Invalid point limit"]}},computed:{gameModeOptions(){return this.gameModes.map((n,t)=>({index:t,name:n.attributes.name}))}},methods:{async handleSubmit(){await this.$refs.form.validate(),this.valid&&this.$emit("armyDetailsSaved",{selectedGameMode:this.gameModes[this.selectedGameModeIndex],name:this.armyName,points:this.armyPoints})}}};function F(n,t,e,c,s,a){const u=o("v-toolbar"),m=o("v-select"),_=o("v-col"),p=o("v-text-field"),d=o("v-btn"),y=o("v-row"),w=o("v-container"),G=o("v-form"),S=o("v-card");return l(),f(h,null,[i(u,{dark:"",color:"primary",title:"Select your game mode",density:"compact"}),i(S,null,{default:r(()=>[i(G,{ref:"form",modelValue:s.valid,"onUpdate:modelValue":t[3]||(t[3]=v=>s.valid=v),onSubmit:t[4]||(t[4]=B(()=>{},["prevent"]))},{default:r(()=>[i(w,null,{default:r(()=>[i(y,null,{default:r(()=>[i(_,{cols:"12",md:"4"},{default:r(()=>[i(m,{ref:"selectElement",modelValue:s.selectedGameModeIndex,"onUpdate:modelValue":t[0]||(t[0]=v=>s.selectedGameModeIndex=v),label:"Select",items:a.gameModeOptions,"item-title":"name","item-value":"index",rules:[v=>v!=null||"Please select your Game Mode"]},null,8,["modelValue","items","rules"])]),_:1}),i(_,{cols:"12",md:"4"},{default:r(()=>[i(p,{modelValue:s.armyName,"onUpdate:modelValue":t[1]||(t[1]=v=>s.armyName=v),label:"Name your army list","validate-on-blur":"",rules:s.armyNameRules,required:""},null,8,["modelValue","rules"])]),_:1}),i(_,{cols:"12",md:"4"},{default:r(()=>[i(p,{modelValue:s.armyPoints,"onUpdate:modelValue":t[2]||(t[2]=v=>s.armyPoints=v),label:"Points Limit",rules:s.armyPointsRules,required:""},null,8,["modelValue","rules"])]),_:1}),i(_,{cols:"12",md:"4"},{default:r(()=>[i(d,{type:"submit",block:"",color:"primary","append-icon":"mdi-arrow-right-bold",class:"mt-2",onClick:a.handleSubmit},{default:r(()=>[U(" continue ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})],64)}const T=C(R,[["render",F]]);const z={name:"UnitProfileDialog",props:{unit:{type:[Object,null],required:!0}},emits:["addUnit"],data(){return{isOpen:!0,displayUnit:null}},computed:{unitStats(){return this.unit.profiles[0]},unitCost(){const{value:n,name:t}=this.unit.costs[0].attributes;return`${parseInt(n,11)} ${t}`}},watch:{modelValue(){this.isOpen=this.modelValue}},mounted(){this.displayUnit=JSON.parse(JSON.stringify(this.unit));for(const n of this.unit.selectionEntries)n.profiles&&this.displayUnit.profiles.push(...n.profiles)}},H={class:"mr-3"},K={key:0};function Q(n,t,e,c,s,a){const u=o("v-spacer"),m=o("v-card-title"),_=o("v-divider"),p=o("v-table"),d=o("v-card-text"),y=o("v-btn"),w=o("v-card-actions"),G=o("v-card");return s.displayUnit?(l(),k(G,{key:0},{default:r(()=>[i(m,{class:"d-flex"},{default:r(()=>[g("div",null,b(s.displayUnit.attributes.name),1),i(u),g("span",H,b(a.unitCost),1)]),_:1}),i(d,null,{default:r(()=>[(l(!0),f(h,null,L(s.displayUnit.profiles,S=>(l(),f("div",{key:S.attributes.id},[S.attributes.name!==e.unit.attributes.name?(l(),f("h4",K,b(S.attributes.name),1)):x("",!0),i(_),i(p,null,{default:r(()=>[g("thead",null,[g("tr",null,[(l(!0),f(h,null,L(S.characteristics,v=>(l(),f("th",{key:v.attributes.id},b(v.attributes.name),1))),128))])]),g("tbody",null,[g("tr",null,[(l(!0),f(h,null,L(S.characteristics,v=>(l(),f("td",{key:v.attributes.id},b(v.attributes.value),1))),128))])])]),_:2},1024)]))),128))]),_:1}),i(w,null,{default:r(()=>[i(u),i(y,{variant:"tonal",color:"primary",onClick:t[0]||(t[0]=S=>n.$emit("addUnit",e.unit))},{default:r(()=>[U(" add unit ")]),_:1})]),_:1})]),_:1})):x("",!0)}const W=C(z,[["render",Q],["__scopeId","data-v-7583f17c"]]);function O(){const n=E();return{gameSystem:V(()=>n.gameSystems[0])}}function N(){const n=E(),{gsCode:t,catId:e}=$().query;return{catalog:V(()=>n.loadCatalogData({gsCode:t,catId:e}))}}function X(){const n=M(),{catalog:t}=N(),e=V(()=>t.value.sharedSelectionEntries),c=V(()=>n.armyList.selectedGameMode.categoryLinks),s=V(()=>{var a;return(a=c.value)==null?void 0:a.reduce((u,m)=>{const _=m.attributes.targetId,p=[];for(const d of e.value)d.categoryLinks&&d.categoryLinks.some(y=>y.attributes.targetId===_)&&p.push(d);return u[_]=p,u},{})});return{units:e,categories:c,unitsByCategory:s}}function Y(n){let t=[],e=[];const c=JSON.parse(JSON.stringify(n));A(c),console.log(c),n.entryLinks.filter(m=>m.attributes.type==="selectionEntry");const s=n.entryLinks.filter(m=>m.attributes.type==="selectionEntryGroup");for(const m of s){const _=m.attributes.targetId,p=P(n,_);if(!p){e.push(m.attributes.targetId);continue}p.entryLinks,e.push(p)}const a=V(()=>t),u=V(()=>e);return{selections:a,selectionGroups:u}}function A(n){let t;for(const e of n.entryLinks){const c=e.attributes.targetId;e.attributes.type==="selectionEntry"&&(t=Z(n,c)),e.attributes.type==="selectionEntryGroup"&&(t=P(n,c)),t&&(t.entryLinks&&A(t),e.target=t)}}function Z(n,t){let e;const{gameSystem:c}=O(),{catalog:s}=N();if(e=n.selectionEntries.find(a=>a.attributes.id===t),e||(e=c.value.sharedSelectionEntries.find(a=>a.attributes.id===t),e)||(e=s.value.sharedSelectionEntries.find(a=>a.attributes.id===t),e)||(e=s.value.linkedSharedSelectionEntries.find(a=>a.attributes.id===t),e))return e}function P(n,t){var a;let e;const{gameSystem:c}=O(),{catalog:s}=N();if(e=(a=n.selectionEntryGroups)==null?void 0:a.find(u=>u.attributes.id===t),e||(e=c.value.sharedSelectionEntryGroups.find(u=>u.attributes.id===t),e)||(e=s.value.sharedSelectionEntryGroups.find(u=>u.attributes.id===t),e)||(e=s.value.linkedSharedSelectionEntryGroups.find(u=>u.attributes.id===t),e))return e}const tt={name:"SelectionEntry",props:{selection:{type:Object,required:!0}}},et={class:"d-flex justify-space-between"};function nt(n,t,e,c,s,a){const u=o("v-checkbox");return l(),f("div",et,[g("div",null,b(e.selection.attributes.name),1),g("div",null,[i(u,{vlaue:e.selection.attributes.id},null,8,["vlaue"])])])}const st=C(tt,[["render",nt]]),it={name:"UnitConstructorDialog",components:{SelectionEntry:st},props:{unit:{type:Object,required:!0}},setup(n){const{selections:t,selectionGroups:e}=Y(n.unit);return{selections:t,selectionGroups:e}},methods:{isVisible(n){const t=n.constraints;return t.length!==2?!0:!t.some(e=>e.attributes.type==="max"&&e.attributes.value==="1.0")&&!t.some(e=>e.attributes.type==="min"&&e.attributes.value==="1.0")}}},ot={class:"d-flex justify-space-between"},rt=g("span",null,"150 pts",-1);function at(n,t,e,c,s,a){const u=o("v-card-title"),m=o("selection-entry"),_=o("v-card-text"),p=o("v-card");return l(),f("div",null,[i(p,null,{default:r(()=>[i(u,null,{default:r(()=>[g("div",ot,[g("span",null,b(e.unit.attributes.name),1),rt])]),_:1}),i(_,null,{default:r(()=>[(l(!0),f(h,null,L(c.selections,d=>(l(),f("div",{key:d.attributes.id},[a.isVisible(d)?(l(),k(m,{key:0,selection:d},null,8,["selection"])):x("",!0)]))),128))]),_:1})]),_:1}),(l(!0),f(h,null,L(c.selectionGroups,d=>(l(),k(p,{key:d.attributes.id},{default:r(()=>[i(u,null,{default:r(()=>[U(b(d.attributes.name),1)]),_:2},1024),i(_,null,{default:r(()=>[(l(!0),f(h,null,L(d.entryLinks,y=>(l(),f("div",{key:y.attributes.id},b(y.attributes.name),1))),128))]),_:2},1024)]),_:2},1024))),128))])}const lt=C(it,[["render",at]]),ut={name:"UnitList",props:{gameMode:{type:Object,required:!0}},emits:["click"],setup(){const{units:n,categories:t,unitsByCategory:e}=X();return{gsStore:E(),units:n,categories:t,unitsByCategory:e}}},ct={class:"pl-3"};function dt(n,t,e,c,s,a){const u=o("v-toolbar"),m=o("v-list-item"),_=o("v-list"),p=o("v-card");return l(!0),f(h,null,L(c.categories,d=>(l(),k(p,{key:d.attributes.id},{default:r(()=>[i(u,{density:"compact"},{default:r(()=>[g("div",ct,b(d.attributes.name),1)]),_:2},1024),i(_,{density:"compact"},{default:r(()=>[(l(!0),f(h,null,L(c.unitsByCategory[d.attributes.targetId],y=>(l(),k(m,{key:y.attributes.id,onClick:w=>n.$emit("click",y)},{default:r(()=>[U(b(y.attributes.name),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024))),128)}const mt=C(ut,[["render",dt]]),_t={name:"ArmyList",props:{armyList:{type:Array,required:!0}}},pt={class:"d-flex"};function ft(n,t,e,c,s,a){const u=o("v-spacer"),m=o("v-list-item"),_=o("v-divider"),p=o("v-list"),d=o("v-card");return l(),k(d,null,{default:r(()=>[i(p,null,{default:r(()=>[(l(!0),f(h,null,L(e.armyList,y=>(l(),f("div",{key:y.attributes.id},[i(m,null,{default:r(()=>[g("div",pt,[g("span",null,b(y.attributes.name),1),i(u),U(" 150pts ")])]),_:2},1024),i(_)]))),128))]),_:1})]),_:1})}const yt=C(_t,[["render",ft]]);const vt={name:"ConstructorView",components:{AppBar:J,UnitProfileDialog:W,ListCreationDialog:T,UnitList:mt,ArmyList:yt,UnitConstructorDialog:lt},setup(){return{gsStore:E(),alStore:M()}},data(){return{isDialogOpen:!1,currentDialog:"list-details",showListDetails:!1,showUnitProfile:!1,showUnitConstructor:!1,selectedUnit:null,tab:"units",armyList:[],localArmyList:null}},computed:{...j(M(),{armyListDetails:"armyList"}),navParams(){return{gameSystemCode:this.$route.query.gs,armyIndex:this.$route.query.ai}},gameData(){return this.gsStore.gameSystems[0]},gameModes(){return this.gameData.forceEntries},selectedGameMode(){return this.alStore.armyList.selectedGameMode}},mounted(){this.alStore.armyList.name===""&&(this.showListDetails=!0,this.isDialogOpen=!0)},methods:{onArmyDetailsSaved(n){this.alStore.updateArmyListState(n),this.showListDetails=!1,this.isDialogOpen=!1},openUnitProfile(n){this.selectedUnit=n,this.currentDialog="unit-profile",this.isDialogOpen=!0},addUnit(){this.currentDialog="unit-constructor"},waitForDialogToClose(n){setTimeout(()=>{n()},400)}}};function gt(n,t,e,c,s,a){const u=o("app-bar"),m=o("v-tab"),_=o("v-tabs"),p=o("unit-list"),d=o("v-window-item"),y=o("army-list"),w=o("v-window"),G=o("list-creation-dialog"),S=o("unit-profile-dialog"),v=o("unit-constructor-dialog"),I=o("v-dialog");return l(),f(h,null,[g("header",null,[i(u,{"disable-margin":""},{default:r(()=>[U(" Constructor ")]),_:1}),i(_,{modelValue:s.tab,"onUpdate:modelValue":t[0]||(t[0]=D=>s.tab=D),"align-tabs":"center",height:"35px",class:"mt-16"},{default:r(()=>[i(m,{value:"units"},{default:r(()=>[U(" Units ")]),_:1}),i(m,{value:"list"},{default:r(()=>[U(" My List ")]),_:1})]),_:1},8,["modelValue"])]),g("main",null,[a.selectedGameMode?(l(),k(w,{key:0,modelValue:s.tab,"onUpdate:modelValue":t[2]||(t[2]=D=>s.tab=D)},{default:r(()=>[i(d,{value:"units"},{default:r(()=>[i(p,{"game-mode":a.selectedGameMode,onClick:t[1]||(t[1]=D=>a.openUnitProfile(D))},null,8,["game-mode"])]),_:1}),i(d,{value:"list"},{default:r(()=>[i(y,{"army-list":s.armyList},null,8,["army-list"])]),_:1})]),_:1},8,["modelValue"])):x("",!0),i(I,{modelValue:s.isDialogOpen,"onUpdate:modelValue":t[3]||(t[3]=D=>s.isDialogOpen=D),transition:"dialog-bottom-transition",fullscreen:"",scrollable:"",persistent:s.currentDialog==="list-details",class:"unit-dialog"},{default:r(()=>[s.currentDialog==="list-details"?(l(),k(G,{key:0,"game-modes":a.gameModes,onArmyDetailsSaved:a.onArmyDetailsSaved},null,8,["game-modes","onArmyDetailsSaved"])):x("",!0),s.currentDialog==="unit-profile"?(l(),k(S,{key:1,unit:s.selectedUnit,onAddUnit:a.addUnit},null,8,["unit","onAddUnit"])):x("",!0),s.currentDialog==="unit-constructor"?(l(),k(v,{key:2,unit:s.selectedUnit},null,8,["unit"])):x("",!0)]),_:1},8,["modelValue","persistent"])])],64)}const kt=C(vt,[["render",gt]]);export{kt as default};
